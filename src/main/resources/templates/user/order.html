<!DOCTYPE html>
<!--suppress ALL -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" th:href="@{/css/main.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/basic.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/style2.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/style/base.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/style/head.css}"/>
    <link rel="stylesheet" th:href="@{/layui/css/layui.css}"/>
    <link type="text/css" th:href="@{/css/front/css.css}" rel="stylesheet"/>
    <script type="text/javascript" th:src="@{/js/jquery.js}"></script>
    <script type="text/javascript" th:src="@{/js/js.js}"></script>
    <script th:src="@{/js/wb.js}" type="text/javascript"></script>
    <script th:src="@{/layui/layui.js}" type="text/javascript"></script>
    <script type="text/javascript" th:src="@{/js/index.js}"></script>
    <script th:src="@{/script/global.js}" type="text/javascript"></script>
    <script th:src="@{/script/head.js}" type="text/javascript"></script>
</head>

<body>

<div th:replace="~{user/common/common::top}"></div>
<!--抬头结束-->
<div class="pnt">
    <div th:replace="~{user/common/common::headNav2}"></div>
</div><!--pnt/-->
<!--中部开始-->
<div class="positions">
    当前位置：<a href="index.html">首页</a> &gt; <a href="#">购物车</a>
</div><!--positions/-->
<div class="carImg"><img th:src="@{/images/car2.jpg}" width="1063" height="30" /></div>
<div class="ding_tjb" style="margin-left: 400px">
    <!--收获地址开始-->
    <div class="lljl_2" style="width:1063px;height:52px; padding-bottom:20px;">
        <div class="lljl_bt1"><span class="lljl_mc" style="border-bottom-color:#90a80b; color:#98b205;">确认收货地址</span></div>
        <div class="address-list">
            <div class="selected-description" >
                <i class="layui-icon layui-icon-location" style="color: #f40;font-weight: bold"></i>
                <span style="color: #f40;font-weight: bold">运送至</span>
            </div>
            <div class="info" style="display: inline">
                <i class="layui-icon layui-icon-radio" style="color: #4545c4;font-weight: bold"></i>
                <span class="address" th:text="${user.address}"></span>
                <span class="name">([[${user.nickname}]] 收)</span>
                <span class="phone" style="color: #a09999" th:text="${user.phone}">17393185928</span>
                <span class="moren">默认地址</span>
            </div>
            <div style="display: inline;margin: 5px 5px;float: right">
                <span>
                    <a onclick="update_address()" href="javascript:;" style="color: #0460a7">修改本地址</a>
                </span>
            </div>
        </div>
    </div>
    <!--收获地址结束-->

    <!--支付方式-->
    <div class="lljl_2" style="height:auto; padding-bottom:20px;">
        <div class="lljl_bt1"><span class="lljl_mc" style="border-bottom-color:#90a80b; color:#98b205;">确认支付方式</span></div>
        <div class="pay" onmouseover="ch1()" onmouseleave="ch2()" style="border: 2px solid #f40">
            <span style="margin-left: 6px;">货到付款</span>
        </div>
    </div>

    <!--订单信息-->
    <div class="lljl_bt1"><span class="lljl_mc" style="border-bottom-color:#90a80b; color:#98b205;">确认订单信息</span></div>
    <div class="ding_1" style="width: 1063px">
        <table width="0" border="0" cellspacing="0" cellpadding="0">
            <tr style=" font-family:微软雅黑; text-align:center; font-size:14px;">
                <th width="390">商品信息</th>
                <th width="170">单价（元）</th>
                <th width="165">数量</th>
                <th width="110">赠送积分</th>
                <th width="225">小计（元）</th>
            </tr>
        </table>
    </div >

    <div class="orderInfo" th:each="cartVo: ${cartVoList}">
        <div style="margin: 15px 0px -15px 8px;">
            <svg t="1611323548456" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3459" width="16" height="16"><path d="M503.944119 98.332322a12.210259 12.210259 0 1 1-12.210259-12.210259 12.282509 12.282509 0 0 1 12.210259 12.210259zM820.977351 98.332322a12.282509 12.282509 0 1 1-12.282509-12.210259 12.282509 12.282509 0 0 1 12.282509 12.210259z" fill="#5FB0E5" p-id="3460"></path><path d="M34.246525 162.562619m-12.210259 0a12.210259 12.210259 0 1 0 24.420518 0 12.210259 12.210259 0 1 0-24.420518 0Z" fill="#5FB0E5" p-id="3461"></path><path d="M301.571721 78.102307m-18.351514 0a18.351513 18.351513 0 1 0 36.703027 0 18.351513 18.351513 0 1 0-36.703027 0Z" fill="#5FB0E5" p-id="3462"></path><path d="M687.676004 53.320539A24.565018 24.565018 0 1 1 663.110986 28.900021a24.565018 24.565018 0 0 1 24.565018 24.420518z" fill="#5FB0E5" p-id="3463"></path><path d="M109.16983 53.320539m-24.709518 0a24.709518 24.709518 0 1 0 49.419036 0 24.709518 24.709518 0 1 0-49.419036 0Z" fill="#5FB0E5" p-id="3464"></path><path d="M115.600085 162.562619h784.491074a30.778523 30.778523 0 0 1 30.778523 30.778523v766.789811H84.460312V193.341142A30.778523 30.778523 0 0 1 115.600085 162.562619z" fill="#FFFFFF" p-id="3465"></path><path d="M948.065194 977.326466H67.264799V192.546391a47.179285 47.179285 0 0 1 47.179285-47.107034h66.975799v34.318775h-66.975799a12.860509 12.860509 0 0 0-12.86051 12.788259v750.38905h812.162845V192.546391a12.860509 12.860509 0 0 0-12.860509-12.788259H419.050307v-34.318775h482.196853a47.179285 47.179285 0 0 1 47.179285 47.107034z" fill="#0686D8" p-id="3466"></path><path d="M244.421929 145.439357h114.299584v34.318775H244.421929z" fill="#0686D8" p-id="3467"></path><path d="M46.456784 918.009172m22.108516 0l878.199393 0q22.108516 0 22.108517 22.108517l0 20.157764q0 22.108516-22.108517 22.108517l-878.199393 0q-22.108516 0-22.108516-22.108517l0-20.157764q0-22.108516 22.108516-22.108517Z" fill="#5FB0E5" p-id="3468"></path><path d="M946.836943 999.507232H68.5653a39.304029 39.304029 0 0 1-39.231779-39.231779v-20.157764a39.304029 39.304029 0 0 1 39.231779-39.304029h878.271643a39.304029 39.304029 0 0 1 39.231779 39.304029v20.157764a39.304029 39.304029 0 0 1-39.231779 39.231779z m-878.271643-64.302547a4.840754 4.840754 0 0 0-4.913003 4.913004v20.157764a4.913004 4.913004 0 0 0 4.913003 4.913004h878.271643a4.985254 4.985254 0 0 0 4.913004-4.913004v-20.157764a4.913004 4.913004 0 0 0-4.913004-4.913004z" fill="#0686D8" p-id="3469"></path><path d="M46.456784 249.190433m22.108516 0l878.199393 0q22.108516 0 22.108517 22.108516l0 20.157764q0 22.108516-22.108517 22.108517l-878.199393 0q-22.108516 0-22.108516-22.108517l0-20.157764q0-22.108516 22.108516-22.108516Z" fill="#5FB0E5" p-id="3470"></path><path d="M946.836943 330.688492H68.5653a39.231779 39.231779 0 0 1-39.231779-39.231779v-20.157764a39.231779 39.231779 0 0 1 39.231779-39.231779h878.271643a39.304029 39.304029 0 0 1 39.231779 39.231779v20.157764a39.304029 39.304029 0 0 1-39.231779 39.231779zM68.5653 266.385945a4.840754 4.840754 0 0 0-4.913003 4.913004v20.157764a4.840754 4.840754 0 0 0 4.913003 4.913004h878.271643a4.913004 4.913004 0 0 0 4.913004-4.913004v-20.157764a4.913004 4.913004 0 0 0-4.913004-4.913004z" fill="#0686D8" p-id="3471"></path><path d="M181.419883 582.913427h207.863402v399.470543H181.419883z" fill="#5FB0E5" p-id="3472"></path><path d="M181.419883 852.261624l207.863402-207.935652v-61.412545h-51.225287l-156.638115 156.638115v112.710082zM181.419883 937.733437l207.863402-207.935652v-39.231779l-207.863402 207.935652v39.231779z" fill="#9ECFEF" p-id="3473"></path><path d="M406.406548 999.507232H164.22437v-433.500317h242.182178z m-207.863403-34.318775h173.400127V600.036689h-173.400127z" fill="#0686D8" p-id="3474"></path><path d="M181.419883 387.766034h207.863402v128.243844H181.419883z" fill="#5FB0E5" p-id="3475"></path><path d="M406.406548 533.205391H164.22437V370.570521h242.182178z m-207.863403-34.318776h173.400127V404.600296h-173.400127z" fill="#0686D8" p-id="3476"></path><path d="M244.421929 828.346857a42.121781 42.121781 0 1 1 42.049531-42.121781 42.194031 42.194031 0 0 1-42.049531 42.121781z m0-49.924787a7.803006 7.803006 0 1 0 7.730756 7.803006 7.803006 7.803006 0 0 0-7.730756-7.803006z" fill="#0686D8" p-id="3477"></path><path d="M521.211882 510.735624h287.48296v329.821492H521.211882z" fill="#5FB0E5" p-id="3478"></path><path d="M521.211882 629.948211v160.973118l280.113455-280.185705H640.352219l-119.140337 119.212587zM635.150215 840.557116l173.544627-173.544627V582.552177l-258.004939 258.004939h84.460312z" fill="#9ECFEF" p-id="3479"></path><path d="M825.890355 857.752628H504.016369v-364.140266h321.873986zM538.335144 823.650603h253.236436V527.931137h-252.875185z" fill="#0686D8" p-id="3480"></path><path d="M462.400339 313.56523h401.638044v226.648416a42.699781 42.699781 0 0 1-42.699781 42.699781H504.95562A42.699781 42.699781 0 0 1 462.400339 540.213646V313.56523z" fill="#9ECFEF" p-id="3481"></path><path d="M521.211882 582.913427A58.956043 58.956043 0 0 1 462.400339 523.957384V313.56523h58.956043zM580.167925 313.56523h58.956043v269.348197H580.167925zM698.007761 313.56523h58.956043v269.348197h-58.956043zM863.966133 541.297396V313.56523h-55.271291v269.348197h13.65526a41.61603 41.61603 0 0 0 41.616031-41.616031z" fill="#D2E9F7" p-id="3482"></path><path d="M786.369576 600.036689H536.312143a91.251817 91.251817 0 0 1-91.179567-91.179566V296.225217H881.450646v209.091653a94.792069 94.792069 0 0 1-95.08107 94.719819zM479.451351 330.688492v178.168631a56.933042 56.933042 0 0 0 56.860792 56.860791h250.057433a60.473294 60.473294 0 0 0 60.401044-60.401044V330.688492z" fill="#0686D8" p-id="3483"></path></svg>
            <span class="seller_id" th:text="${cartVo.sellerId}" hidden></span>
            <span class="cart_id" th:text="${cartVo.id}" hidden></span>
            <span class="seller_name" style="color: #666;line-height: 30px;font-weight: 700;">[[${cartVo.sellerName}]] 的店铺</span>
        </div>
        <div class="dingd_sl" style="width: 1063px;height: 71px;margin-top: 15px;background-color: rgb(251, 252, 255);border-bottom: 1px dotted rgb(221, 221, 221);" >
            <table width="0" border="0" cellspacing="0" cellpadding="0">
                <tr style=" font-family:微软雅黑; text-align:center; font-size:14px;">
                    <td class="goods_id" th:text="${cartVo.goodsId}" hidden></td>
                    <td width="390">
                        <span class="ddtp_3" style="margin: 5px 0px 0px 5px;"><img th:src="@{${cartVo.photoUrl}}" width="59" height="58" /></span>
                        <span class="ddmc_xq" style=" width:255px;">
                        <a href="#" th:text="${cartVo.goodsTitle}"></a>
                    </span>
                    </td>
                    <td class="price" width="170" style="color:#F00;">￥[[${cartVo.price}]]</td>
                    <td class="quantity" width="165" th:text="${cartVo.quantity}"></td>
                    <td class="integral" width="110" th:text="${#numbers.formatInteger(cartVo.price/10*cartVo.quantity,0)}"></td>
                    <td width="225" style="color:#F00;">￥[[${cartVo.cost}]]</td>
                </tr>
            </table>
        </div>
        <div class="detail">
            <div style="margin-left: 10px;margin-top: 3px;display: inline">
                <span style="float: left;margin-left: 10px">给卖家留言:</span>
                <textarea class="remark" rows="2" cols="45"  placeholder="选填" style="border: 1px solid #666;margin: 5px 0px 0px 2px;resize: none" ></textarea>
            </div>
            <div style="display: inline;position: absolute;margin: 2px 0px 0px 224px;">
                <span>配送方式：</span>
                <input value="1" class="delivery" type="radio" th:name="${cartVo.goodsId}" checked> 上门自取 <br>
                <input value="0" class="delivery" type="radio" th:name="${cartVo.goodsId}" style="margin-left: 75px"> 货主配送
            </div>
        </div>
    </div>
    <div class="jxgw_zj" style="height:92px;">
        <div class="jxgw_wq" style="width:168px; margin-top:30px;"><a th:href="@{/cart.html}">返回购物车修改订单商品</a></div>
    </div>

    <div class="lljl_bt1" style="border-bottom:1px solid #e4e4e4;"><span class="lljl_mc" style="border-bottom-color:#90a80b; color:#98b205;">确认结算信息</span></div>
    <div class="qrxx_2">
        <div class="none" style="height:10px;"></div>
        <div class="qrxx_2_1">商品数量：<span style="color:#F00;" th:text="${cartVoList.size()}"></span></div>
        <div class="qrxx_2_1">商品金额：<span style="color:#F00;">￥[[${totalCost}]]</span> &nbsp;&nbsp;运费金额：<span style="color:#F00;">￥0.00</span></div>
    </div>


    <div class="zjs2">
        <div class="none" style="height:15px;"></div>
        <div class="zjs2_1">应付金额：<span style="color:#F00; font-size:17px;">￥[[${totalCost}]]</span></div>
        <div class="qjs"><a href="javascript:;" onclick="submitOrder()">提交订单</a></div>
    </div>
</div>

<!--中部结束-->

<!--底部开始-->
<div th:replace="~{user/common/common::inHelp}"></div>
<!--修改收货地址-->
<div class="address-info" style="margin-top: 20px" hidden>
    <div class="layui-form-item">
        <label class="layui-form-label">地址信息：</label>
        <div class="layui-input-block" style="width: 300px">
            <input type="text" value="兰州交通大学" readonly="readonly" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">详细地址：</label>
        <div class="layui-input-block" style="width: 300px">
            <input type="text" id="address" th:value="${user.address}" placeholder="请输入详细地址信息，如宿舍楼、宿舍号等信息" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">姓&nbsp;&nbsp;名：</label>
        <div class="layui-input-block" style="width: 300px">
            <input type="text" id="name" th:value="${user.nickname}"  placeholder="请输入收货人姓名" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">电&nbsp;&nbsp;话：</label>
        <div class="layui-input-block" style="width: 300px">
            <input type="text" id="phone" th:value="${user.phone}" placeholder="请输入收货人电话" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div style="margin-left: 200px">
        <button onclick="saveadd()" class="layui-btn layui-btn-sm" style="width: 65px" >保存</button>
    </div>
</div>
<!--底部结束-->
<script>

    /*修改收货地址*/
    function update_address() {
        layui.use('layer' , function () {
            this.lsyer = layui.layer;
            layer.open({
                type: 1,
                content: $('.address-info'),
                area: ['510px','375px'],
                title: '修改地址'
            });
        })
    }
    function saveadd() {
        var address = $('.address').text($('#address').val());
        var name = $('.name').text($('#name').val());
        var phone = $('.phone').text($('#phone').val());
        $('.moren').hide();
        layui.use('layer' , function () {
            this.lsyer = layui.layer;
            layer.closeAll('page');
        });
    }
    /*订单处理*/
    function submitOrder() {
        let orderArray = new Array();
        $('.orderInfo').each(function () {
            let order = {};
            var cartId = $(this).find('.cart_id').text();
            var sellerId = $(this).find('.seller_id').text();
            var goodsId = $(this).find('.goods_id').text();
            var quantity = $(this).find('.quantity').text();
            var integral = $(this).find('.integral').text();
            var delivery = $(this).find("input[class='delivery']:checked").val();
            var remark = $(this).find('.remark').val();
            order.cartId = cartId;
            order.sellerId = sellerId;
            order.goodsId = goodsId;
            order.quantity = quantity;
            order.delivery = delivery;
            order.integral = integral;
            order.remark = remark;
            orderArray.push(order);
        });
        $.ajax({
            url: '/order/add',
            data: {"orderArray":JSON.stringify(orderArray)},
            success: function (msg) {
                window.location.href='/success.html';
            },
            error: function (msg) {
                window.location.href='/success.html';
            }
        });
    }
</script>

</body>
</html>
